#!/usr/bin/env node
var http = require('http');
var net = require('net');

var s = http.createServer(function(req, res) {
  console.log('HTTP URL:'+req.url);
  var tunnel_params = JSON.parse((new Buffer(req.url.split('/')[1], 'base64')).toString());
  console.log('Someone connected. They want '+tunnel_params.address+' on port '+tunnel_params.port);
  var socket = net.connect({port: tunnel_params.port, host: tunnel_params.address}, function() {
    console.log('made the connection');
  });
  res.writeHead(200);
  req.pipe(socket).pipe(res);
});

s.listen(3001);

// vim: set filetype=javascript syntax=javascript :
